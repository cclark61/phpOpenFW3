<?php
//*****************************************************************************
//*****************************************************************************
/**
 * Core Database Type Trait
 *
 * @package         phpopenfw/phpopenfw3/phpopenfw3
 * @author          Christian J. Clark
 * @copyright       Copyright (c) Christian J. Clark
 * @website         https://phpopenfw.org
 * @license         https://mit-license.org
 **/
//*****************************************************************************
//*****************************************************************************

namespace phpOpenFW\Database\Structure\DatabaseTypes;

//*****************************************************************************
/**
 * Core Trait
 */
//*****************************************************************************
trait Core
{
    //*************************************************************************
    //*************************************************************************
    // Get Data Source
    //*************************************************************************
    //*************************************************************************
    protected static function GetDataSource($data_source)
    {
        return \phpOpenFW\Core\DataSources::GetOneOrDefault($data_source);
    }

    //*************************************************************************
    //*************************************************************************
    // Determine Schema from a Table
    //*************************************************************************
    //*************************************************************************
    public static function DetermineSchema($data_source, $table, $default=false, $separator=false)
    {
        //=====================================================================
        // Get Data Source
        //=====================================================================
        $ds_obj = self::GetDataSource($data_source);

        //=====================================================================
        // Check for separator
        //=====================================================================
        if (!$separator) {
            $separator = '.';
        }

        //=====================================================================
        // Set Default Schema
        //=====================================================================
        $schema = (isset($ds_obj->schema)) ? ($ds_obj->schema) : (false);

        //=====================================================================
        // Determine Schema
        //=====================================================================
        $table_parts = explode($separator, $table);
        if (is_array($table_parts)) {
            $table = $table_parts[count($table_parts) - 1];
            if (isset($table_parts[count($table_parts) - 2])) {
                $schema = $table_parts[count($table_parts) - 2];
            }
        }
        if (!$schema && $default) {
            $schema = $default;
        }

        return [
            'table' => $table,
            'schema' => $schema
        ];
    }
}
