<?php
//*****************************************************************************
//*****************************************************************************
/**
 * CLI Args Trait
 *
 * @package         phpOpenFW
 * @author          Christian J. Clark
 * @copyright       Copyright (c) Christian J. Clark
 * @website         https://phpopenfw.org
 * @license         https://mit-license.org
 **/
//*****************************************************************************
//*****************************************************************************

namespace phpOpenFW\CLI\Traits;

//*****************************************************************************
/**
 * Args Trait
 */
//*****************************************************************************
trait Args
{
    //*************************************************************************
    //*************************************************************************
    // Class Members
    //*************************************************************************
    //*************************************************************************
    protected $args = [];

    //*************************************************************************
    //*************************************************************************
    // Parse Arguments
    //*************************************************************************
    //*************************************************************************
    protected static function ParseArgs($args)
    {
        //print_r($args);
        $num_args = count($args);
        $new_args = array();
        $open_arg = false;
        $arg_val = false;
        for ($i = 1; $i < $num_args; $i++) {

            //------------------------------------------------------
            // Current Argument
            //------------------------------------------------------
            $arg = $args[$i];

            //------------------------------------------------------
            // Next Argument
            //------------------------------------------------------
            $next_arg = (isset($args[$i+1])) ? ($args[$i+1]) : (false);
            if (substr($next_arg, 0, 1) == '-' || substr($next_arg, 0, 2) == '--') {
                $arg_val = false;
            }
            else {
                $arg_val = $next_arg;
            }

            //------------------------------------------------------
            // Long Argument
            //------------------------------------------------------
            if (substr($arg, 0, 2) == '--') {
                $switch = substr($arg, 2);
                $new_args[$switch] = ($arg_val != '') ? ($arg_val) : (true);
                if ($arg_val != '') {
                    $i++;
                }
            }
            //------------------------------------------------------
            // Switch
            //------------------------------------------------------
            else if (substr($arg, 0, 1) == '-' && strlen($arg) == 2) {
                $switch = substr($arg, 1);
                $new_args[$switch] = ($arg_val != '') ? ($arg_val) : (true);
                if ($arg_val != '') {
                    $i++;
                }
            }
            //------------------------------------------------------
            // Loose Argument
            //------------------------------------------------------
            else {
                $new_args['loose_args'][] = $arg;
            }
        }

        //---------------------------------------------------------------------
        // Is command set?
        //---------------------------------------------------------------------
        if (isset($new_args['loose_args'][0])) {
            $new_args['__command'] = $new_args['loose_args'][0];
        }
        else {
            $new_args['__command'] = false;
        }

        return $new_args;
    }
}
